jQuery(document).ready((function(e){"use strict";function t(){e(".remove_field").unbind(),e(".probability").on("change",(function(){o()})),e(".remove_field").on("click",(function(){if(o(),confirm("Would you want to remove this?")){if(!(e(".wheel_col").length>3))return alert("Must have at least 3 columns!"),!1;e(this).closest("tr").remove(),o(),l()}}))}function o(){let t=0;return e(".probability").each((function(){let o=e(this).val();!0===e.isNumeric(o)&&(t+=parseInt(o))})),e(".total_probability").html(t),e(".total_probability").attr("data-total_probability",t),t}function l(){let t=document.getElementsByClassName("wheel_col_index");for(let o=0;o<t.length;o++)e(".wheel_col_index")[o].innerHTML=o+1}function n(){e(".coupons_select").dropdown({onChange:function(t){"non"===t?(e(this).parent().parent().find(".coupon_amount").val(0),e(this).parent().parent().find(".coupon_amount").prop("readonly",!0),e(this).parent().parent().find(".coupon_amount").addClass("coupon-amount-readonly"),e(this).parent().parent().find(".coupon_amount").show(),e(this).parent().parent().find(".custom_type_value").hide(),e(this).parent().parent().find(".custom_type_label").val("Not Lucky"),e(this).parent().parent().find(".wlwl_existing_coupon").hide()):"custom"===t?(e(this).parent().parent().find(".wlwl_existing_coupon").hide(),e(this).parent().parent().find(".coupon_amount").hide(),e(this).parent().parent().find(".custom_type_value").val(""),e(this).parent().parent().find(".custom_type_label").val(""),e(this).parent().parent().find(".custom_type_value").show()):(e(this).parent().parent().find(".custom_type_label").val(e("#wheel_label_coupon").val()),"existing_coupon"===t?(e(this).parent().parent().find(".coupon_amount").hide(),e(this).parent().parent().find(".custom_type_value").hide(),e(this).parent().parent().find(".wlwl_existing_coupon").show()):(e(this).parent().parent().find(".wlwl_existing_coupon").hide(),e(this).parent().parent().find(".coupon_amount").removeClass("coupon-amount-readonly"),e(this).parent().parent().find(".coupon_amount").prop("readonly",!1),e(this).parent().parent().find(".coupon_amount").show(),e(this).parent().parent().find(".custom_type_value").hide()))}})}e(".vi-ui.tabular.menu .item").vi_tab({history:!0,historyType:"hash"}),e(".vi-ui.accordion").length&&e(".vi-ui.accordion:not(.wlwl-accordion-init)").addClass("wlwl-accordion-init").vi_accordion("refresh"),e(".vi-ui.checkbox:not(.wlwl-checkbox-init)").addClass("wlwl-checkbox-init").off().checkbox(),e(".vi-ui.dropdown:not(.wlwl-dropdown-init)").addClass("wlwl-dropdown-init").off().dropdown(),e(".wheel-settings .ui-sortable").sortable({update:function(e,t){l()}}),e(".color-picker").iris({change:function(t,o){e(this).parent().find(".color-picker").css({backgroundColor:o.color.toString()}),e(this).parent().find("#wheel_wrap_bg_color")&&e(".wlwl-image-container").find(".review-images").css({background:o.color.toString()});let l=e(this).data("ele");"highlight"==l?e("#message-purchased").find("a").css({color:o.color.toString()}):"textcolor"==l?e("#message-purchased").css({color:o.color.toString()}):e("#message-purchased").css({backgroundColor:o.color.toString()})},hide:!0,border:!0}).on("click",(function(){e(".iris-picker").hide(),e(this).closest("td").find(".iris-picker").show()})),e("body").on("click",(function(){e(".iris-picker").hide()})),e(".color-picker").on("click",(function(e){e.stopPropagation()})),e(".probability").on("keyup",(function(){e(this).val()>100&&e(this).val(100)})),t(),function i(){e(".clone_piece").on("click",(function(){if(e(".wheel_col").length>=6)alert("Maximum pieces quantity is 6");else{let a=e(this).parent().parent().clone(),r=parseInt(e(".total_probability").attr("data-total_probability")),c=0;r+parseInt(a.find('input[name="probability[]"]').val())<=100&&(c=parseInt(a.find('input[name="probability[]"]').val())),e(".total_probability").html(r+c),e(".total_probability").attr("data-total_probability",r+c),a.find('input[name="probability[]"]').val(c),a.insertAfter(e(this).parent().parent()),l(),o(),t(),e(".color-picker").iris({change:function(t,o){e(this).parent().find(".color-picker").css({backgroundColor:o.color.toString()})},hide:!0,border:!0,width:270}).on("click",(function(e){e.stopPropagation()})),n(),e(".clone_piece").unbind(),i()}}))}(),e("#submit").on("click",(function(){let t=o(),l=document.getElementsByClassName("custom_type_label");if(100==t){for(let t=0;t<l.length;t++){if(""===e(".custom_type_label").eq(t).val())return alert("Label cannot be empty."),e(".custom_type_label").eq(t).focus(),!1;if("custom"===e(".coupons_select").eq(t).val()&&""===e(".custom_type_value").eq(t).val())return alert("Value cannot be empty."),e(".custom_type_value").eq(t).focus(),!1;if("existing_coupon"===e(".coupons_select").eq(t).val()&&""==e('select[name="wlwl_existing_coupon[]"]')[t].lastElementChild.innerHTML)return alert("Value of Existing coupon cannot be empty."),e('select[name="wlwl_existing_coupon[]"]')[t].focus(),!1}return!0}return alert("The total probability must be 100%."),!1})),l(),n(),e(".wlwl_color_palette").on("click",(function(){let t=e(this).data("color_code"),o=[],l=e(".color_palette").data("color_arr")[t];l?.pointer&&e("#pointer_color").val(l.pointer).trigger("change"),e("#wheel_wrap_bg_color").val(t).trigger("change"),l?.color&&l.color.length&&(o=l.color);let n,i=e(".wheel_col").find('input[name="bg_color[]"]').map((function(){return e(this).val()})).get(),a=o.length,r=i.length,c=0;for(n=0;n<r;n++)c==a&&(c=0),e(".wheel_col").find('input[name="bg_color[]"]').eq(n).val(o[c]).css({"background-color":o[c]}),c++;e(".auto_color_ok").on("click",(function(){e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()})),e(".auto_color_cancel").on("click",(function(){for(c=0,n=0;n<r;n++)c==a&&(c=0),e(".wheel_col").find('input[name="bg_color[]"]').eq(n).val(i[c]).css({"background-color":i[c]}),c++;e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()}))})),e(".auto_color").on("click",(function(){e(".color_palette").css({display:"flex"}),e(".auto_color_ok_cancel").css({display:"inline-block"}),e(this).hide(),e(".auto_color_ok").on("click",(function(){e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()})),e(".auto_color_cancel").on("click",(function(){e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()}))}))})),jQuery(document).ready((function(e){"use strict";let t,o=e("#wlwl-bg-image"),l=o.find(".wlwl-upload-custom-img"),n=o.find(".wlwl-image-container");function i(t){parseInt(t)?(e(".wheel_wrap_bg_image_custom").show(),e(".wlwl-remove-image").length?e(".wlwl-upload-custom-img").hide():e(".wlwl-upload-custom-img").show()):(e(".wheel_wrap_bg_image_custom").hide(),e(".wheel_wrap_bg_image").val(woo_lucky_wheel_params_admin.bg_img_default),n.find(".review-images").attr({src:woo_lucky_wheel_params_admin.bg_img_default}))}e(".wheel_wrap_bg_image_custom").css("margin-top","15px"),e(".wheel_wrap_bg_image_type").dropdown({onChange:function(e){i(e)}}),i(e(".wheel_wrap_bg_image_type select").val()),l.on("click",(function(o){o.preventDefault(),t||(t=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:!1}),t.on("select",(function(){let o,l=t.state().get("selection").first().toJSON();console.log(l),l.sizes.thumbnail?o=l.sizes.thumbnail.url:l.sizes.medium?o=l.sizes.medium.url:l.sizes.large?o=l.sizes.large.url:l.url&&(o=l.url),n.append('<img style="width: 300px;background:'+e("#wheel_wrap_bg_color").val()+'"class="review-images" src="'+o+'"/><input class="wheel_wrap_bg_image" name="wheel_wrap_bg_image" type="hidden" value="'+l.id+'"/><span class="wlwl-remove-image negative vi-ui button small">Remove</span>'),e(".wlwl-upload-custom-img").hide()}))),t.open()})),e(document).on("click",".wlwl-remove-image",(function(t){t.preventDefault(),e(this).parent().html(""),e(".wlwl-upload-custom-img").show()}))})),jQuery(document).ready((function(e){"use strict";let t,o=e("#wlwl-bg-image1"),l=o.find(".wlwl-upload-custom-img1"),n=o.find("#wlwl-new-image1");l.on("click",(function(o){o.preventDefault(),t||(t=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:!1}),t.on("select",(function(){let o,l=t.state().get("selection").first().toJSON();console.log(l),l.sizes.thumbnail?o=l.sizes.thumbnail.url:l.sizes.medium.url?o=l.sizes.medium:l.sizes.large.url?o=l.sizes.large:l.url&&(o=l.url),n.append('<div class="wlwl-image-container1"><img style="border: 1px solid;"class="review-images" src="'+o+'"/><input class="wheel_center_image" name="wheel_center_image" type="hidden" value="'+l.id+'"/><span class="wlwl-remove-image1 nagative vi-ui button">Remove</span></div>'),e(".wlwl-upload-custom-img1").hide(),e(".wlwl-remove-image1").on("click",(function(t){t.preventDefault(),e(this).parent().html(""),e(".wlwl-upload-custom-img1").show()}))}))),t.open()})),e(".wlwl-remove-image1").on("click",(function(t){t.preventDefault(),e(this).parent().html(""),e(".wlwl-upload-custom-img1").show()})),e(".category-search").select2({closeOnSelect:!1,placeholder:"Please enter category title",ajax:{url:"admin-ajax.php?action=wlwl_search_cate",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e(".product-search").select2({closeOnSelect:!1,placeholder:"Please fill in your product title",ajax:{url:"admin-ajax.php?action=wlwl_search_product",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e(".coupon-search").select2({placeholder:"Type coupon code here",ajax:{url:"admin-ajax.php?action=wlwl_search_coupon",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e("#wlwl-google-font-select").fontselect().change((function(){e("#wlwl-google-font-select").val(e(this).val()),e(".wlwl-google-font-select-remove").show()})),e(".wlwl-google-font-select-remove").on("click",(function(){e(this).parent().find(".font-select span").html("<span>Select a font</span>"),e("#wlwl-google-font-select").val(""),e(this).hide()}));let i=e(".wlwl-button-shop-now");e("#wlwl_button_shop_url").on("keyup",(function(){i.attr("href",e(this).val())})),e(".preview-emails-html-overlay").on("click",(function(){e(".preview-emails-html-container").addClass("preview-html-hidden")})),e(".wlwl-preview-emails-button").on("click",(function(){e(".wlwl-preview-emails-button").html("Please wait..."),e.ajax({url:woo_lucky_wheel_params_admin.url,type:"GET",dataType:"JSON",data:{action:"wlwl_preview_emails",heading:e("#heading").val(),content:tinyMCE.get("content")?tinyMCE.get("content").getContent():e("#content").val(),button_shop_url:e("#wlwl_button_shop_url").val()},success:function(t){e(".wlwl-preview-emails-button").html("Preview emails"),t&&(e(".preview-emails-html").html(t.html),e(".preview-emails-html-container").removeClass("preview-html-hidden"))},error:function(t){e(".wlwl-preview-emails-button").html("Preview emails")}})})),e(".woocommerce-lucky-wheel-preview-overlay").on("click",(function(){e(".woocommerce-lucky-wheel-preview").addClass("preview-html-hidden")})),e(".preview-lucky-wheel").on("click",(function(){e(this).addClass("loading");let t=[];e('input[name="bg_color[]"]').map((function(){t.push(e(this).val())}));let o=e("#slice_text_color").val(),l=[];e('input[name="custom_type_label[]"]').map((function(){l.push(e(this).val())}));let n=[];e('select[name="coupon_type[]"]').map((function(){n.push(e(this).val())}));let i=[];e('input[name="coupon_amount[]"]').map((function(){i.push(e(this).val())})),e.ajax({url:woo_lucky_wheel_params_admin.url,type:"GET",dataType:"JSON",data:{action:"wlwl_preview_wheel",label:l,coupon_type:n,coupon_amount:i},success:function(l){e(".preview-lucky-wheel").removeClass("loading");let n=e("#wheel_center_color").val(),i=t.length,a=360/i,r=-a/2,c=document.getElementById("wlwl_canvas"),s=c.getContext("2d"),u=400;c.width=u,c.height=u;let p=200,h=parseInt(u/28);if(l.labels){let d=l.labels;for(let e=0;e<i;e++)m(s,r,t[e]),_(s,r+a/2,d[e],o,h),r+=a;c=document.getElementById("wlwl_canvas1"),s=c.getContext("2d"),c.width=u,c.height=u,function(e,t,o){e.save(),e.beginPath(),e.fillStyle=o,e.shadowBlur=1,e.shadowOffsetX=8,e.shadowOffsetY=8,e.shadowColor="rgba(0,0,0,0.2)",e.arc(p,p,50,0,2*Math.PI),e.fill(),e.clip(),e.restore()}(s,0,n);let f=e('input[name="wheel_center_image"]').parent().find("img").attr("src");if(f){let e=new Image;e.onload=function(){c=document.getElementById("wlwl_canvas1"),s=c.getContext("2d");s.arc(p,p,43,0,2*Math.PI),s.clip(),s.drawImage(e,157,157,86,86)},e.src=f}w(s,"#ffffff","rgba(0,0,0,0)",20,4,5,"rgba(0,0,0,0.2)"),c=document.getElementById("wlwl_canvas2"),s=c.getContext("2d"),c.width=u,c.height=u,w(s,"rgba(0,0,0,0)","#000000",20,4,5,"rgba(0,0,0,0)"),e(".woocommerce-lucky-wheel-preview").removeClass("preview-html-hidden")}function d(e){return e*Math.PI/180}function m(e,t,o){let l;e.beginPath(),e.fillStyle=o,e.moveTo(p,p),l=190,e.arc(p,p,l,d(t),d(t+a)),e.lineTo(p,p),e.fill()}function w(e,t,o,l,n,r,c){let s,u,h;e.beginPath(),e.strokeStyle=t,e.lineWidth=l,e.shadowBlur=1,e.shadowOffsetX=8,e.shadowOffsetY=8,e.shadowColor=c,e.arc(p,p,p,0,2*Math.PI),e.stroke(),h=a/2;let d=p-r;for(let t=0;t<i;t++)e.beginPath(),e.fillStyle=o,s=p+d*Math.cos(h*Math.PI/180),u=p-d*Math.sin(h*Math.PI/180),e.arc(s,u,n,0,2*Math.PI),e.fill(),h+=a}function _(e,t,o,l,n){e.save(),e.translate(p,p),e.rotate(d(t)),e.textAlign="right",e.fillStyle=l,e.font="200 "+n+"px Helvetica",e.shadowOffsetX=0,e.shadowOffsetY=0;let i=(o=o.replace(/&#(\d{1,4});/g,(function(e,t){return String.fromCharCode(t)}))).split("/n"),a="",r="";i.length>1&&(a=i[0],r=i.splice(1,i.length-1),r=r.join("")),""!==a.trim()&&""!==r.trim()?(e.fillText(a.trim(),175,-1*n/4),e.fillText(r.trim(),175,3*n/4)):e.fillText(o,175,n/2-2),e.restore()}},error:function(t){e(".wlwl-preview-emails-button").html("Preview emails"),e(".preview-lucky-wheel").removeClass("loading")}})}))}));